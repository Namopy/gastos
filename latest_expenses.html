<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Últimos Movimientos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #movementsTable td, #movementsTable th {
            font-size: 1.2rem; /* Aumentar tamaño de texto para mejor visibilidad */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Últimos Movimientos</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Importe</th>
                    <th>Concepto</th>
                    <th>Banco</th> <!-- NUEVO -->
                </tr>
            </thead>
            <tbody id="movementsTable">
                <tr><td colspan="4">Cargando datos...</td></tr>
            </tbody>
        </table>
        <a href="index.html" class="btn btn-secondary">Atrás</a>
    </div>

    <script>
        fetch("https://script.google.com/macros/s/AKfycbwhzO4ciRg2mMu2nd0TCxdpksfTw2RJQgQyxFKHBiLNSQgXIRg_wGS9mnrIdEQFj9dN/exec?getLatest=5")
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById('movementsTable');
                table.innerHTML = ""; // Limpiar contenido previo
                if (data && Array.isArray(data) && data.length > 0) {
                    data.forEach(row => {
                        let formattedDate = 'Sin fecha';
                        let formattedAmount = 'Sin importe';
                        let concept = row[2] || 'Sin concepto';
                        let bank = row[3] || '-';                    // NUEVO

                        // Formatear la fecha
                        try {
                            const date = new Date(row[0]);
                            if (!isNaN(date)) {
                                formattedDate = date.toISOString().split('T')[0]; // Formato YYYY-MM-DD
                            }
                        } catch (error) {
                            console.error("Error al formatear la fecha:", error);
                        }

                        // Formatear el importe con coma decimal
                        if (row[1]) {
                            formattedAmount = parseFloat(row[1]).toLocaleString('es-ES', {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                            });
                        }

                        // Crear fila de la tabla
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>€${formattedAmount}</td>
                            <td>${concept}</td>
                            <td>${bank}</td>                           <!-- NUEVO -->

                        `;
                        table.appendChild(tr);
                    });
                } else {
                    table.innerHTML = '<tr><td colspan="4">No hay datos disponibles</td></tr>';
                }
            })
            .catch(error => {
                console.error("Error al obtener los movimientos:", error);
                document.getElementById('movementsTable').innerHTML = '<tr><td colspan="4">Error al cargar los datos</td></tr>';
            });
    </script>
</body>
</html>
